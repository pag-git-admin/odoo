<odoo>
    <!--PG-17-Scorecard-Proof-of-Concept-->
    <template id="external_layout_boxed_custom">
        <t t-foreach="docs" t-as="doc">
            <div t-attf-class="header o_company_#{doc.company_id.id}_layout">
                <table class="table table-borderless" style="width: 100%;">
                    <tr>
                        <td style="text-align: left; vertical-align: middle;">
                            <h1>
                                <!--PG-38-Ability-to-print-scorecards-for-more-than-1-parent-task-->
                                <span style="font-weight: bold;">Scorecard Report for 
                                    
                                    <t t-esc="task.name"/>
                                </span>
                            </h1>
                        </td>
                        <td style="text-align: right; vertical-align: middle;">
                            <img t-if="doc.company_id.logo" class="o_company_logo_big" t-att-src="image_data_uri(doc.company_id.logo)" alt="Logo"  />
                        </td>
                    </tr>
                </table>
            </div>
            <div t-attf-class="article o_report_layout_boxed o_table_boxed o_company_#{doc.company_id.id}_layout o_snail_mail {{'o_report_layout_background' if doc.company_id.layout_background != 'Blank' else ''}}"
             t-attf-style="background-image: url({{ 'data:image/png;base64,%s' % doc.company_id.layout_background_image.decode('utf-8') if doc.company_id.layout_background_image and doc.company_id.layout_background == 'Custom' else
                           '/base/static/img/demo_logo_report.png' if doc.company_id.layout_background == 'Demo logo' else ''}});"
             t-att-data-oe-model="o and o._name"
             t-att-data-oe-id="o and o.id"
             t-att-data-oe-lang="o and o.env.context.get('lang')">
                <t t-out="0"/>
            </div>
            <div t-attf-class="footer o_company_#{doc.company_id.id}_layout {{report_type != 'pdf' and 'mt-auto'}}">
                <div class="o_footer_content row border-top pt-2">
                    <div class="col-8"></div>
                    <div class="col-4 text-end">
                        <span t-if="report_type == 'pdf'" class="text-muted">Page 
                            
                            <span class="page"/> / 
                            
                            <span class="topage"/></span>
                    </div>
                </div>
            </div>
        </t>
    </template>
    <template id="report_pag_scoreboard">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <div class="page" style="margin:0; padding:0;">
                    <t t-call="pag_customizations.external_layout_boxed_custom">
                        <div style="margin:0; padding:0;">
                            <style>
                            table { 
                                page-break-inside:auto;
                                width:100%;
                                border-collapse:collapse;
                                table-layout:fixed;
                            }
                            thead { display:table-header-group; }
                            tr { page-break-inside:avoid; }
                            td, th { font-size:12px; }
                           

                        </style>
                            <t t-set="months"
                           t-value="['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC']"/>
                            <table style="width:100%; border-collapse:collapse; table-layout:fixed;">
                                <!-- ================= HEADER ================= -->
                                <thead>
                                    <tr style="background-color:#217ED5; color:white;">
                                        <th style="width:30%; border:1px solid black; padding:6px; text-align:left;">
    TARGET TO IMPROVE
</th>
                                        <th style="width:8%; border:1px solid black; padding:6px;"></th>
                                        <t t-foreach="months" t-as="month">
                                            <th style="border:1px solid black; padding:6px; text-align:center;">
                                                <t t-esc="month"/>
                                            </th>
                                        </t>
                                        <th style="border:1px solid black; padding:6px; text-align:center;">
                                        YTD
                                    </th>
                                    </tr>
                                </thead>
                                <!-- ================= BODY ================= -->
                                <tbody>
                                    <t t-foreach="task.child_ids" t-as="subtask">
                                        <!-- ========= PLAN ROW ========= -->
                                        <tr style="page-break-inside: avoid;">
                                            <td rowspan="2"
    style="
        border:1px solid black;
        padding:6px;
        vertical-align:middle;
        white-space:normal;
        word-break:break-word;
        line-height:1.3;
    ">
                                                <t t-esc="subtask.name"/>
                                            </td>
                                            <td style="border:1px solid black; padding:6px; vertical-align:middle;">
                                            Plan
                                        </td>
                                            <t t-foreach="months" t-as="month">
                                                <t t-set="month_task"
                                               t-value="subtask.child_ids.filtered(lambda m: month.lower() in m.name.lower())"/>
                                                <t t-set="plan_val"
                                               t-value="month_task[0].plan_1 if month_task else 0"/>
                                                <!-- Future Month Check -->
                                                <t t-set="is_future"
                                               t-value="month_task and month_task[0].task_date and month_task[0].task_date > context_timestamp(datetime.datetime.now()).date()"/>
                                                <td t-attf-style="
                                                border:1px solid black;
                                                text-align:center;
                                                padding:4px; vertical-align:middle;
                                                background-color: {{ 'lightgray' if is_future else 'white' }};
                                                color: {{ '#999' if is_future else 'black' }};
                                            ">
                                                    <t t-if="month_task and month_task[0].rollup_type == '4'">
                                                        <t t-esc="int(plan_val)"/> %
                                                </t>
                                                    <t t-else="">
                                                        <t t-esc="int(plan_val)"/></t>
                                                </td>
                                            </t>
                                            <!-- YTD PLAN -->
                                            <td style="border:1px solid black; text-align:center; padding:4px;vertical-align:middle;">
                                                <t t-if="subtask.rollup_type == '4'">
                                                    <t t-esc="int(subtask.plan_1)"/> %
                                            </t>
                                                <t t-else="">
                                                    <t t-esc="int(subtask.plan_1)"/></t>
                                            </td>
                                        </tr>
                                        <!-- ========= ACTUAL ROW ========= -->
                                        <tr style="page-break-inside: avoid;">
                                            <td style="border:1px solid black; padding:6px; vertical-align:middle;">
                                            Actual
                                        </td>
                                            <t t-set="last_actual" t-value="0"/>
                                            <t t-foreach="months" t-as="month">
                                                <t t-set="month_task"
                                               t-value="subtask.child_ids.filtered(lambda m: month.lower() in m.name.lower())"/>
                                                <t t-set="actual_val"
                                               t-value="month_task[0].actual_1 if month_task and month_task[0].actual_1 else 0"/>
                                                <t t-set="status_name"
                                               t-value="month_task[0].task_status.name if month_task and month_task[0].task_status else ''"/>
                                                <!-- Status Color Mapping -->
                                                <t t-set="status_color"
                                               t-value="
                                                   'gray' if status_name == 'Not Started'
                                                   else 'blue' if status_name == 'On Track'
                                                   else '#FFBF00' if status_name == 'At Risk/Delayed'
                                                   else 'red' if status_name == 'Blocked'
                                                   else 'green' if status_name == 'Completed'
                                                   else 'white'
                                               "/>
                                                <td t-attf-style="
                                                border:1px solid black; vertical-align:middle;
                                                text-align:center;
                                                padding:4px;
                                                background-color: {{ status_color }};
                                                color: {{ 'black' if not status_name else 'white' }};
                                            ">
                                                    <t t-if="month_task and month_task[0].rollup_type == '4'">
                                                        <t t-esc="int(actual_val)"/> %
                                                </t>
                                                    <t t-else="">
                                                        <t t-esc="int(actual_val)"/></t>
                                                </td>
                                                <t t-set="today" t-value="datetime.date.today()"/>
                                                <t t-set="current_month" t-value="12 if today.month == 1 else today.month-1"/>
                                                <t t-foreach="range(0, current_month)" t-as="m_index">
                                                    <t t-set="month_name" t-value="months[m_index]"/>
                                                    <t t-set="last_month_task" t-value="subtask.child_ids.filtered(lambda m: month_name.lower() in m.name.lower())"/>
                                                    <t t-set="last_month_actual_val"
                                                       t-value="last_month_task[0].actual_1 if last_month_task and last_month_task[0].actual_1 else 0"/>
                                                    <t t-set="last_actual" t-value="last_month_actual_val"/></t>
                                            </t>
                                            <!-- YTD ACTUAL -->
                                            <t t-set="status_name"
                                           t-value="subtask.task_status.name if subtask.task_status else ''"/>
                                            <t t-set="status_color"
                                           t-value="
                                               'gray' if status_name == 'Not Started'
                                               else 'blue' if status_name == 'On Track'
                                               else '#FFBF00' if status_name == 'At Risk/Delayed'
                                               else 'red' if status_name == 'Blocked'
                                               else 'green' if status_name == 'Completed'
                                               else 'white'
                                           "/>
                                            <td t-attf-style="
                                            border:1px solid black; vertical-align:middle;
                                            text-align:center;
                                            padding:4px;
                                            background-color: {{ status_color }};
                                            color: {{ 'black' if not status_name else 'white' }};
                                        ">
                                                <t t-if=" last_month_task[0].rollup_type == '4'">
                                                    <t t-esc="int(last_actual)"/> %
                                                    </t>
                                                <t t-else="">
                                                    <t t-esc="int(last_actual)"/></t>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>
    <record id="paperformat_pag_landscape" model="report.paperformat">
        <field name="name">PAG Landscape Format</field>
        <field name="format">A4</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">27</field>
        <field name="margin_bottom">15</field>
        <field name="margin_left">0</field>
        <field name="header_spacing">26</field>
        <field name="margin_right">0</field>
        <field name="default" eval="False"/>
    </record>
    <record id="action_pag_scoreboard_report" model="ir.actions.report">
        <field name="name">Scoreboard Report</field>
        <field name="model">scoreboard.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">pag_customizations.report_pag_scoreboard</field>
        <field name="report_file">pag_customizations.report_pag_scoreboard</field>
        <field name="paperformat_id" ref="pag_customizations.paperformat_pag_landscape"/>
    </record>
</odoo>